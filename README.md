## **Obsidian Local Vault Server Plugin**
**ローカル環境で安全に Vault のファイルをホスティングするための Obsidian プラグイン**

### **概要**
Obsidian Local Vault Server Plugin は、Vault 内の特定のファイルをローカル HTTP サーバーを介して配信するためのプラグインです。  
単なるローカルサーバーではなく、以下の **セキュリティ機能** を備えています。(私はセキュリティのスペシャリストではないので、問題が生じる可能性があります。)

✅ **ホワイトリスト方式** – 指定したファイルのみを公開  
✅ **認証トークン** – `Authorization: Bearer <token>` によるアクセス制限（オプション）  
✅ **ディレクトリトラバーサル防止** – Vault 外のアクセスを完全に遮断  
✅ **CORS 制限** – 同一オリジンポリシーを適用し、不正アクセスを防止  
✅ **ローカルホスト限定** – デフォルトでは `127.0.0.1` でのみ動作し、外部公開を防ぐ  

このプラグインを使えば、ローカル環境で安全にファイルを共有しながら、プライバシーを守ることができます。

---

## **インストール**

### **1. 公式プラグインとして導入（今後対応予定）**
Obsidian の **「コミュニティプラグイン」** から検索してインストールできます。

### **2. 手動インストール**
1. [リリースページ](https://github.com/your-repo/obsidian-local-vault-server-plugin/releases) から最新の `main.js`, `manifest.json`, `styles.css` をダウンロード。
2. Obsidian の `plugins` フォルダ（`<Vault>/.obsidian/plugins/obsidian-local-vault-server-plugin/`）に配置。
3. **Obsidian の設定 → コミュニティプラグイン → 「Obsidian Local Vault Server Plugin」を有効化**。

---

## **設定方法**

プラグインを有効にした後、**「プラグインの設定」** から以下の項目を設定できます。

### **基本設定**
| 設定項目 | 説明 | デフォルト値 |
|----------|----------------------------|-------------|
| **Host** | ローカルサーバーのバインドアドレス（外部公開を防ぐため `127.0.0.1` 推奨） | `127.0.0.1` |
| **Port** | サーバーのポート番号 | `3000` |
| **Serve Folder** | 公開する Vault 内のフォルダを選択 | 任意のフォルダ |

### **セキュリティ設定**
| 設定項目 | 説明 | デフォルト |
|----------|------------------------------------|-----------|
| **Enable Whitelist** | ホワイトリスト方式を有効化（チェックしたファイルのみ公開） | `true` |
| **Whitelist Files** | 公開を許可するファイル一覧（相対パス） | 空 |
| **Authentication Token** | 設定すると HTTP リクエスト時に `Authorization: Bearer <token>` ヘッダーが必須になる | 空 |

### **ログ・監査（今後追加予定）**
| 設定項目 | 説明 | デフォルト |
|----------|--------------------------------|-----------|
| **Enable Logging** | アクセスログを記録する | `false` |

---

## **使用方法**

### **1. ローカルサーバーの起動**
プラグインを有効にすると、自動で **`http://127.0.0.1:3000/`** にサーバーが立ち上がります。  
ブラウザや HTTP クライアント（`curl`, `Postman` など）を使ってファイルにアクセスできます。

**例：`sample.md` にアクセス**
```
http://127.0.0.1:3000/sample.md
```

### **2. 認証トークンを設定した場合**
トークンを設定した場合、リクエスト時に `Authorization` ヘッダーを追加する必要があります。

**例：`curl` を使ったリクエスト**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" http://127.0.0.1:3000/sample.md
```

---

## **セキュリティ対策**

本プラグインは、Obsidian の Vault を安全にホスティングするため、以下のセキュリティ機構を実装しています。

### **✅ 1. ホワイトリストによるアクセス制御**
- デフォルトでは Vault 内の全ファイルを非公開にし、**ユーザーが明示的に許可したファイルのみ** 公開します。
- 設定画面のチェックリストでファイルごとに公開設定が可能。

### **✅ 2. 認証トークン**
- **設定しない場合**：誰でも `http://127.0.0.1:3000/` にアクセス可能  
- **設定する場合**：Bearer トークンを持っているリクエストのみ許可

### **✅ 3. ディレクトリトラバーサル攻撃の防止**
- `path.normalize()` と `fs.realpath()` を使用し、Vault 外のファイルには **絶対にアクセスできない** ように設計。

### **✅ 4. CORS（クロスオリジン制限）**
- 他のウェブサイトから不正にアクセスされるのを防ぐため、デフォルトでは **同一オリジン（`http://127.0.0.1:3000`）以外からのアクセスを拒否** します。

### **✅ 5. ローカルホスト限定**
- `Host` の初期設定が `127.0.0.1` になっているため、意図しない外部公開のリスクを最小限に抑えます。

---


## **ロードマップ**
✅ **認証トークンの実装**（完了）  
✅ **ホワイトリスト機能**（完了）  


---

## **ライセンス**
本プラグインは **MITライセンス** のもとで提供されます。自由に使用・改変・再配布できますが、利用者の責任においてご使用ください。

---

## **開発者向け情報**
### **コントリビューション**
機能追加やバグ報告は [GitHub リポジトリ](https://github.com/your-repo/obsidian-local-vault-server-plugin) で受け付けています。

**Pull Request を歓迎します！**

---

この `README.md` は、Obsidian のユーザー向けに分かりやすく情報を整理し、設定・利用方法・セキュリティ対策を明確に伝えることを目的としています。